<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1,user-scalable=no"><meta name="renderer" content="webkit"><meta name="color-scheme" content="dark light"><meta name="author" content="John Doe"><meta name="description" content=""><meta name="keywords" content=""><title>Hexo</title><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="//at.alicdn.com/t/font_3242539_utq6ykfq7z.css"><link rel="stylesheet" light-src="https://cdn.staticfile.org/highlight.js/11.5.0/styles/default.min.css" dark-src="https://cdn.staticfile.org/highlight.js/11.5.0/styles/tokyo-night-dark.min.css"><link rel="stylesheet" href="https://fonts.font.im/css?family=Noto+Serif" as="font"><link href="/style/index.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.2"></head><body><header class="page-header"><nav><ul class="router-list"><li class="nav-item"> <a href="/">主页</a></li><li class="nav-item"> <a href="/archives/">归档</a></li><li class="nav-item"> <a href="/atom.xml">RSS</a></li></ul><div class="mode-switch"><span class="iconfont icon-DarkTheme"></span></div></nav></header><main><section class="main-content"><section class="post-page"><div class="title-bar"><h1></h1><div class="post-info"><span>2023-01-04 21:49:06</span><span class="tags"></span></div></div><article> <div class="content"><h2 id="C语言"><a href="#C语言" class="headerlink" title="C语言"></a>C语言</h2><h3 id="全局变量和局部变量"><a href="#全局变量和局部变量" class="headerlink" title="全局变量和局部变量"></a>全局变量和局部变量</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">Plus</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">10</span>;<span class="comment">//局部变量</span></span><br><span class="line">    <span class="comment">//宽度，种类，作用域。</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//程序的入口</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	Plus();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        假如局部变量 x=10，因为它是在函数Plus中的变量，所以称为局部变量，而这种变量是无法在其他函数中调用的，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">plus</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">10</span>;<span class="comment">//plus局部变量</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	plus();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,x);<span class="comment">//这里打印会报错，原因就是作用域的问题</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        说起变量，就得谈谈变量格式转换问题，如下代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> c = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> a = i; <span class="comment">//类型如何转换，汇编层面如何显示</span></span><br></pre></td></tr></table></figure>

<p>​        在汇编里类型转换如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//MOVSX先符号扩展，再传送，符号位是什么补什么 </span><br><span class="line">MOV AL,OFF</span><br><span class="line">MOVSX CX,AL</span><br><span class="line">MOV AL,80</span><br><span class="line">MOVSX CX,AL</span><br><span class="line">//MOVZX 先零扩展，再传送</span><br><span class="line">MOV AL,0XFF</span><br><span class="line">MOVZX CX,AL</span><br><span class="line">MOV AL,80</span><br><span class="line">MOVZX CX,AL</span><br></pre></td></tr></table></figure>

<p>​        继续观察如下例子，类型转换，小转大：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> i = <span class="number">0xFF</span>;</span><br><span class="line"><span class="type">short</span> k = <span class="number">0xFFFF</span>;</span><br><span class="line"><span class="type">int</span> h = <span class="number">0xFFFFFFFF</span></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"><span class="type">short</span> k = i;</span><br><span class="line"><span class="type">int</span> h = i;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0xFF</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> k = <span class="number">0x00FF</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> h = <span class="number">0x00000000FF</span>;</span><br></pre></td></tr></table></figure>

<p>​        拓展的时候，有符号数和无符号数是有区别的，以上C代码转为汇编语言，如下：    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	char i = 0xFF;</span><br><span class="line">00007FF7EF7D176B  mov         byte ptr [i],0FFh  </span><br><span class="line">	short k = i;</span><br><span class="line">00007FF7EF7D176F  movsx       ax,byte ptr [i]  </span><br><span class="line">00007FF7EF7D1774  mov         word ptr [k],ax  </span><br><span class="line">	int h = i;</span><br><span class="line">00007FF7EF7D1778  movsx       eax,byte ptr [i]  </span><br><span class="line">00007FF7EF7D177C  mov         dword ptr [h],eax </span><br></pre></td></tr></table></figure>

<p>​        这里采用的是<code>MOVSX</code>的方式存储的，多余位采用符号位补齐。</p>
<p>​        如果为无符号数的汇编表示，则采用<code>MOVZX</code>的方式，采用0来补齐多余位，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	unsigned char i = 0xFF;</span><br><span class="line">00007FF7DD8E238B  mov         byte ptr [i],0FFh  </span><br><span class="line">	short k = i;</span><br><span class="line">00007FF7DD8E238F  movzx       eax,byte ptr [i]  </span><br><span class="line">00007FF7DD8E2393  mov         word ptr [k],ax  </span><br><span class="line">	int h = i;</span><br><span class="line">00007FF7DD8E2397  movzx       eax,byte ptr [i]  </span><br><span class="line">00007FF7DD8E239B  mov         dword ptr [h],eax</span><br></pre></td></tr></table></figure>

<p>​        大转小原理就是截取有效位的数据，一般截取低位保存，丢弃了高位。</p>
<h3 id="分支语句"><a href="#分支语句" class="headerlink" title="分支语句"></a>分支语句</h3><p>​        IF语句：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件判断)<span class="comment">//如果真，执行1，否则执行2</span></span><br><span class="line">&#123;</span><br><span class="line">	表达式<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	表达式<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>()</span><br><span class="line">&#123;</span><br><span class="line">    表达式<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>()</span><br><span class="line">&#123;</span><br><span class="line">    表达式<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    表达式<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">do&#123;</span><br><span class="line"></span><br><span class="line">&#125;while()</span><br><span class="line"></span><br><span class="line">while()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for(;;;)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>参数传递</p>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test</span>&#123;</span></span><br><span class="line">	<span class="type">int</span> life;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="type">int</span> height;</span><br><span class="line">    <span class="type">float</span> tele;</span><br><span class="line">    <span class="type">char</span> name[<span class="number">15</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结构体对齐"><a href="#结构体对齐" class="headerlink" title="结构体对齐"></a>结构体对齐</h3><p>本质：效率还是空间，二选一的结果</p>
<p>对齐参数：</p>
<h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.添加case后面的值，一个一个增加，观察反汇编代码的变化（何时生成大表）</span><br><span class="line"></span><br><span class="line">2.将常量值的顺序打乱，观察反汇编代码（观察顺序是否会受到影响生成大表）</span><br><span class="line"></span><br><span class="line">3.将case后面的值改成从100开始到109，观察汇编变化（观察值较大时是否生成大表）</span><br><span class="line"></span><br><span class="line">4.将连续的10项中抹去1项和两项，观察反汇编有无变化（观察大表空缺位置的处理）</span><br><span class="line"></span><br><span class="line">5.在10项中连续抹去，不要抹去最大值和最小值（观察何时生成小表）</span><br><span class="line"></span><br><span class="line">6.将case后面的常量表达式改成毫不连续的值，观察反汇编变化</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Function1</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Function1(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">//提升堆栈</span><br><span class="line">00401020   push        ebp</span><br><span class="line">00401021   mov         ebp,esp</span><br><span class="line">00401023   sub         esp,44h</span><br><span class="line">00401026   push        ebx</span><br><span class="line">00401027   push        esi</span><br><span class="line">00401028   push        edi</span><br><span class="line">00401029   lea         edi,[ebp-44h]</span><br><span class="line">0040102C   mov         ecx,11h</span><br><span class="line">00401031   mov         eax,0CCCCCCCCh</span><br><span class="line">00401036   rep stos    dword ptr [edi]</span><br><span class="line">//switch开始</span><br><span class="line">00401038   mov         eax,dword ptr [ebp+8]</span><br><span class="line">0040103B   mov         dword ptr [ebp-4],eax</span><br><span class="line">0040103E   cmp         dword ptr [ebp-4],1</span><br><span class="line">00401042   je          Function1+32h (00401052) //判断是否等于1，如果是跳转</span><br><span class="line">00401044   cmp         dword ptr [ebp-4],2</span><br><span class="line">00401048   je          Function1+41h (00401061)//判断是否等于2，如果是跳转</span><br><span class="line">0040104A   cmp         dword ptr [ebp-4],3</span><br><span class="line">0040104E   je          Function1+50h (00401070)//判断是否等于3，如果是跳转</span><br><span class="line">00401050   jmp         Function1+5Fh (0040107f)//如果都不满足，跳转</span><br><span class="line"></span><br><span class="line">00401052   push        offset string &quot;1&quot; (00422028)</span><br><span class="line">00401057   call        printf (00401140)</span><br><span class="line">0040105C   add         esp,4</span><br><span class="line"></span><br><span class="line">0040105F   jmp         Function1+6Ch (0040108c)</span><br><span class="line"></span><br><span class="line">00401061   push        offset string &quot;2&quot; (00422024)</span><br><span class="line">00401066   call        printf (00401140)</span><br><span class="line">0040106B   add         esp,4</span><br><span class="line"></span><br><span class="line">0040106E   jmp         Function1+6Ch (0040108c)</span><br><span class="line"></span><br><span class="line">00401070   push        offset string &quot;4&quot; (00422020)</span><br><span class="line">00401075   call        printf (00401140)</span><br><span class="line">0040107A   add         esp,4</span><br><span class="line"></span><br><span class="line">0040107D   jmp         Function1+6Ch (0040108c)</span><br><span class="line"></span><br><span class="line">0040107F   push        offset string &quot;5&quot; (0042201c)</span><br><span class="line">00401084   call        printf (00401140)</span><br><span class="line">00401089   add         esp,4</span><br></pre></td></tr></table></figure>

<p>​    通过以上的汇编代码可以看见，当<code>switch</code>分支过少的时候采用的是<code>if...else</code>方法来判断语句是否满足条件。</p>
<p>​    可以尝试着加上多条分支，来查看结果，如下C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Function1</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Function1(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">//提升堆栈</span><br><span class="line">00401020   push        ebp</span><br><span class="line">00401021   mov         ebp,esp</span><br><span class="line">00401023   sub         esp,44h</span><br><span class="line">00401026   push        ebx</span><br><span class="line">00401027   push        esi</span><br><span class="line">00401028   push        edi</span><br><span class="line">00401029   lea         edi,[ebp-44h]</span><br><span class="line">0040102C   mov         ecx,11h</span><br><span class="line">00401031   mov         eax,0CCCCCCCCh</span><br><span class="line">00401036   rep stos    dword ptr [edi]</span><br><span class="line"></span><br><span class="line">00401038   mov         eax,dword ptr [ebp+8]</span><br><span class="line">0040103B   mov         dword ptr [ebp-4],eax</span><br><span class="line">0040103E   mov         ecx,dword ptr [ebp-4] </span><br><span class="line">00401041   sub         ecx,1</span><br><span class="line">//上面语句意思为将参数传入eax，再将eax放入局部变量ebp-4的位置，再移动到ecx，ecx-1</span><br><span class="line">//所以这里传入的外部参数为2，2-1，所以现在ecx=1</span><br><span class="line"></span><br><span class="line">00401044   mov         dword ptr [ebp-4],ecx</span><br><span class="line">00401047   cmp         dword ptr [ebp-4],5 </span><br><span class="line">0040104B   ja          $L542+0Fh (004010b1)</span><br><span class="line">//这里为ebp-4（1）和5作比较，如果大就跳转</span><br><span class="line"></span><br><span class="line">0040104D   mov         edx,dword ptr [ebp-4]</span><br><span class="line">00401050   jmp         dword ptr [edx*4+4010CFh]</span><br><span class="line">//这里判断为1&lt;5，不满足条件，所以继续执行，最后jmp到（edx=1，edx*4=4，edx*4+4010CFH=4010D3h）4010D3h这个位置来。</span><br><span class="line">//这个地址存放的是eip的地址，所以当执行这个语句后，eip会直接跳转到00401066（见下图1）</span><br><span class="line">//00401066这个地址就刚好对应printf(&quot;2&quot;)</span><br><span class="line">00401057   push        offset string &quot;1&quot; (0042213c)</span><br><span class="line">0040105C   call        printf (00401140)</span><br><span class="line">00401061   add         esp,4</span><br><span class="line"></span><br><span class="line">00401064   jmp         $L542+1Ch (004010be)</span><br><span class="line"></span><br><span class="line">00401066   push        offset string &quot;2&quot; (0042202c)</span><br><span class="line">0040106B   call        printf (00401140)</span><br><span class="line">00401070   add         esp,4</span><br><span class="line"></span><br><span class="line">00401073   jmp         $L542+1Ch (004010be)</span><br><span class="line"></span><br><span class="line">00401075   push        offset string &quot;3&quot; (00422028)</span><br><span class="line">0040107A   call        printf (00401140)</span><br><span class="line">0040107F   add         esp,4</span><br><span class="line"></span><br><span class="line">00401082   jmp         $L542+1Ch (004010be)</span><br><span class="line"></span><br><span class="line">00401084   push        offset string &quot;4&quot; (00422024)</span><br><span class="line">00401089   call        printf (00401140)</span><br><span class="line">0040108E   add         esp,4</span><br><span class="line"></span><br><span class="line">00401091   jmp         $L542+1Ch (004010be)</span><br><span class="line"></span><br><span class="line">00401093   push        offset string &quot;5&quot; (00422020)</span><br><span class="line">00401098   call        printf (00401140)</span><br><span class="line">0040109D   add         esp,4</span><br><span class="line"></span><br><span class="line">004010A0   jmp         $L542+1Ch (004010be)</span><br><span class="line"></span><br><span class="line">004010A2   push        offset string &quot;4&quot; (00422024)</span><br><span class="line">004010A7   call        printf (00401140)</span><br><span class="line">004010AC   add         esp,4</span><br><span class="line"></span><br><span class="line">004010AF   jmp         $L542+1Ch (004010be)</span><br><span class="line"></span><br><span class="line">004010B1   push        offset string &quot;6&quot; (0042201c)</span><br><span class="line">004010B6   call        printf (00401140)</span><br><span class="line">004010BB   add         esp,4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    图1:</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="E:\文档\admin\assets\image-20220927235728633.png"" alt="image-20220927235728633"></p>
<p>​    通过上面的分析，可以看出当switch语句使用分支过多的时候，编译器会自动创建一个大表来存储要跳转的地址。而不是再次使用多个判断语句，这样既节省了内存空间，也提高了运行效率。</p>
<p>​    如果顺序被打乱了呢，假设不是case1，2，3，4，5这样，而是case1，5，2，4，3这样，大表也不会受到影响。具体可用如上代码测试，只是大表中的eip地址变化了，但不影响查询大表。</p>
<p>​    这里需要注意一些问题，就是当从表达式子中删除一些分支的时候，编译器会如何处理，当表达式的值不连续的时候编译器又会如何处理。</p>
<p>第一个问题：</p>
<p>C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Function1</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">/*case 7:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);//这里随机删除几个</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 8:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 9:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);</span></span><br><span class="line"><span class="comment">			break;*/</span></span><br><span class="line">		<span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Default&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Function1(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//switch开始</span><br><span class="line">0040D7E8   mov         eax,dword ptr [ebp+8]</span><br><span class="line">0040D7EB   mov         dword ptr [ebp-4],eax</span><br><span class="line">0040D7EE   mov         ecx,dword ptr [ebp-4]</span><br><span class="line">0040D7F1   sub         ecx,1</span><br><span class="line">0040D7F4   mov         dword ptr [ebp-4],ecx</span><br><span class="line">0040D7F7   cmp         dword ptr [ebp-4],9</span><br><span class="line">0040D7FB   ja          $L543+0Fh (0040d870)</span><br><span class="line">0040D7FD   mov         edx,dword ptr [ebp-4]</span><br><span class="line">0040D800   jmp         dword ptr [edx*4+40D88Eh]</span><br><span class="line">//可以看见这里判断用的方式和之前没有任何区别</span><br><span class="line"></span><br><span class="line">0040D807   push        offset string &quot;1&quot; (0042213c)</span><br><span class="line">0040D80C   call        printf (00401140)</span><br><span class="line">0040D811   add         esp,4</span><br><span class="line">0040D814   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D816   push        offset string &quot;2&quot; (0042202c)</span><br><span class="line">0040D81B   call        printf (00401140)</span><br><span class="line">0040D820   add         esp,4</span><br><span class="line">0040D823   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D825   push        offset string &quot;3&quot; (00422028)</span><br><span class="line">0040D82A   call        printf (00401140)</span><br><span class="line">0040D82F   add         esp,4</span><br><span class="line">0040D832   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D834   push        offset string &quot;4&quot; (00422024)</span><br><span class="line">0040D839   call        printf (00401140)</span><br><span class="line">0040D83E   add         esp,4</span><br><span class="line">0040D841   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D843   push        offset string &quot;5&quot; (00422020)</span><br><span class="line">0040D848   call        printf (00401140)</span><br><span class="line">0040D84D   add         esp,4</span><br><span class="line">0040D850   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D852   push        offset string &quot;6&quot; (00422024)</span><br><span class="line">0040D857   call        printf (00401140)</span><br><span class="line">0040D85C   add         esp,4</span><br><span class="line">0040D85F   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D861   push        offset string &quot;10&quot; (00422024)</span><br><span class="line">0040D866   call        printf (00401140)</span><br><span class="line">0040D86B   add         esp,4</span><br><span class="line">0040D86E   jmp         $L543+1Ch (0040d87d)</span><br><span class="line">0040D870   push        offset string &quot;default&quot; (0042201c)</span><br><span class="line">0040D875   call        printf (00401140)</span><br><span class="line">0040D87A   add         esp,4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    这里主要分析内存中大表存储的地址，如下图：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="E:\文档\admin\assets\image-20220928002109804.png"" alt="image-20220928002109804"></p>
<p>​    观察0040DB70（这里采用小端模式，高位在后）在上面的地址为default地址，所以可以确定，当1-10中我们删除一些分支时候，编译器会自动的将删除的位置补上default的地址，那如果数一多的话，编译器该如何，这里就引申出小表的说法，如下:</p>
<p>​    C代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Function1</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">/*case 2:</span></span><br><span class="line"><span class="comment">			printf(&quot;2&quot;);</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 3:</span></span><br><span class="line"><span class="comment">			printf(&quot;3&quot;);</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 4:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);</span></span><br><span class="line"><span class="comment">			break;*/</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">/*case 6:</span></span><br><span class="line"><span class="comment">			printf(&quot;6&quot;);</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 7:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);//这里随机多删除几个</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 8:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);</span></span><br><span class="line"><span class="comment">			break;</span></span><br><span class="line"><span class="comment">		case 9:</span></span><br><span class="line"><span class="comment">			printf(&quot;4&quot;);</span></span><br><span class="line"><span class="comment">			break;*/</span></span><br><span class="line">		<span class="comment">/*case 10:</span></span><br><span class="line"><span class="comment">			printf(&quot;10&quot;);</span></span><br><span class="line"><span class="comment">			break;*/</span></span><br><span class="line">		<span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">/*case 12:</span></span><br><span class="line"><span class="comment">			printf(&quot;10&quot;);</span></span><br><span class="line"><span class="comment">			break;*/</span></span><br><span class="line">		<span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Default&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Function1(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    现在我删除了多个分支，接着看看汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">//switch开始</span><br><span class="line">00401038   mov         eax,dword ptr [ebp+8]</span><br><span class="line">0040103B   mov         dword ptr [ebp-4],eax</span><br><span class="line">0040103E   mov         ecx,dword ptr [ebp-4]</span><br><span class="line">00401041   sub         ecx,1</span><br><span class="line">00401044   mov         dword ptr [ebp-4],ecx</span><br><span class="line">00401047   cmp         dword ptr [ebp-4],0Ch</span><br><span class="line">0040104B   ja          $L538+0Fh (0040109b)</span><br><span class="line">0040104D   mov         eax,dword ptr [ebp-4]</span><br><span class="line">00401050   xor         edx,edx</span><br><span class="line">00401052   mov         dl,byte ptr  (004010cd)[eax]//这个地址也是一个表的地址，小表地址</span><br><span class="line"></span><br><span class="line">00401058   jmp         dword ptr [edx*4+4010B9h]</span><br><span class="line">//这里是重点，这里去了多执行了 mov dl,byte ptr  (004010cd)[eax]</span><br><span class="line">//该语句意思为将004010cd的地址加上eax，放到dl,也就是edx中的低八位寄存器dl中，</span><br><span class="line">//我压入的参数为2，这里取过来就是1+004010cd=004020ce，如下图1</span><br><span class="line">//这里004020ce对应的1字节是04，所以返回过来到edx中。</span><br><span class="line">//然后edx再*4+4410B9H,就是最后的结果，如下图2</span><br><span class="line"></span><br><span class="line">//假设传入的是5，5-1=4，所以小表的地址004010cd+4=00104010d1，对应图1返回01</span><br><span class="line">//01*4+4010B9H=4010BD</span><br><span class="line">//查大表4010BD=0040106E，所以打印5。</span><br><span class="line"></span><br><span class="line">0040105F   push        offset string &quot;1&quot; (00422030)</span><br><span class="line">00401064   call        printf (004011a0)</span><br><span class="line">00401069   add         esp,4</span><br><span class="line">0040106C   jmp         $L538+1Ch (004010a8)</span><br><span class="line">0040106E   push        offset string &quot;5&quot; (0042202c)</span><br><span class="line">00401073   call        printf (004011a0)</span><br><span class="line">00401078   add         esp,4</span><br><span class="line">0040107B   jmp         $L538+1Ch (004010a8)</span><br><span class="line">0040107D   push        offset string &quot;10&quot; (00422028)</span><br><span class="line">00401082   call        printf (004011a0)</span><br><span class="line">00401087   add         esp,4</span><br><span class="line">0040108A   jmp         $L538+1Ch (004010a8)</span><br><span class="line">0040108C   push        offset string &quot;10&quot; (00422028)</span><br><span class="line">00401091   call        printf (004011a0)</span><br><span class="line">00401096   add         esp,4</span><br><span class="line">00401099   jmp         $L538+1Ch (004010a8)</span><br><span class="line">0040109B   push        offset string &quot;Default&quot; (0042201c)</span><br><span class="line">004010A0   call        printf (004011a0)</span><br><span class="line">004010A5   add         esp,4</span><br></pre></td></tr></table></figure>

<p>​    </p>
<p>图1：</p>
<p>​    图中黑色框起来的部分就是小表的位置，因为取的是1个字节，所以每次移动一个字节。04，01，都是会返回的。</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="E:\文档\admin\assets\image-20220928004825437.png"" alt="image-20220928004825437"></p>
<p>图2：</p>
<p>​    这里就是大表的地址，而其中004010c9就是我传入参数2的计算地址，因为代码中的switch没有2</p>
<p>的分支所以0040109B对应过来的地址如上，就是Default的地址。</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" 
  class="img-loading" data-original="E:\文档\admin\assets\image-20220928005614188.png"" alt="image-20220928005614188"></p>
<p>​    从上可以看出，当使用<code>switch</code>分支多断续时，会造成内存空间浪费，编译器会自动采用比较优良的算法来把内存空间节省出来，增加效率，这里就是大表加小表的方式来对内存空间进行查址。</p>
<p>​    继续考虑，如果当出现case1，200，300，1000这种情况，编译器该如何处理，如下C代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Function1</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">		<span class="keyword">case</span> <span class="number">300</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1000</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Default&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Function1(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">00401038   mov         eax,dword ptr [ebp+8]</span><br><span class="line">0040103B   mov         dword ptr [ebp-4],eax</span><br><span class="line">0040103E   cmp         dword ptr [ebp-4],12Ch //300</span><br><span class="line">00401045   jg          Function1+41h (00401061)//比较是否大于300</span><br><span class="line">00401047   cmp         dword ptr [ebp-4],12Ch</span><br><span class="line">0040104E   je          Function1+6Ah (0040108a)//比较是否等于300</span><br><span class="line">00401050   cmp         dword ptr [ebp-4],1</span><br><span class="line">00401054   je          Function1+4Ch (0040106c)//比较是否等于1</span><br><span class="line">00401056   cmp         dword ptr [ebp-4],0C8h</span><br><span class="line">0040105D   je          Function1+5Bh (0040107b)//比较是否等于200</span><br><span class="line">0040105F   jmp         Function1+88h (004010a8)</span><br><span class="line">00401061   cmp         dword ptr [ebp-4],3E8h//1000</span><br><span class="line">00401068   je          Function1+79h (00401099)//比较是否等于1000</span><br><span class="line">0040106A   jmp         Function1+88h (004010a8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0040106C   push        offset string &quot;1&quot; (00422030)</span><br><span class="line">00401071   call        printf (004011a0)</span><br><span class="line">00401076   add         esp,4</span><br><span class="line">00401079   jmp         Function1+95h (004010b5)</span><br><span class="line">0040107B   push        offset string &quot;5&quot; (0042202c)</span><br><span class="line">00401080   call        printf (004011a0)</span><br><span class="line">00401085   add         esp,4</span><br><span class="line">00401088   jmp         Function1+95h (004010b5)</span><br><span class="line">0040108A   push        offset string &quot;10&quot; (00422028)</span><br><span class="line">0040108F   call        printf (004011a0)</span><br><span class="line">00401094   add         esp,4</span><br><span class="line">00401097   jmp         Function1+95h (004010b5)</span><br><span class="line">00401099   push        offset string &quot;10&quot; (00422028)</span><br><span class="line">0040109E   call        printf (004011a0)</span><br><span class="line">004010A3   add         esp,4</span><br><span class="line">004010A6   jmp         Function1+95h (004010b5)</span><br><span class="line">004010A8   push        offset string &quot;Default&quot; (0042201c)</span><br><span class="line">004010AD   call        printf (004011a0)</span><br><span class="line">004010B2   add         esp,4</span><br></pre></td></tr></table></figure>

<p>​    从上代码可以看出其实这样写也可以，但是就是影响了效率，因为一旦你的分支多了起来，程序每次就会校验判断一次是否满足条件。在实际情况中建议采用顺序写法，case，1，2，3，4，5。</p>
</div></article><div class="copyright-wrapper"><p>原文作者:<a href="http://example.com">John Doe</a></p><p>原文链接:<a href="http://example.com/2023/01/04/C%E8%AF%AD%E8%A8%80/"></a></p><p>发表日期: 2023-01-04 21:49:06</p><p>更新日期: 2023-01-14 01:48:15</p><p>版权声明: 本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class="post-pager"><div class="prev"><a href="/2023/01/04/%E8%8A%82%E8%A1%A8/" title="">上一篇 </a></div><div class="next"> </div></div><link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.css"/><script src="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.js"></script><div id="gitalk-container"></div><script>new Gitalk({
  clientID: '',
  clientSecret: '',
  repo: '',
  owner: 'EAN',
  admin: 'EAN',
  id: location.pathname.substr(0, 48),
  distractionFreeMode: true,
  labels: ['Gitalk'],
  title: '',
}).render('gitalk-container');</script></section></section></main><footer class="footer-page"><div><span>Powered by</span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a><span>| Theme</span><a target="_blank" rel="noopener" href="https://github.com/techmovie/hexo-theme-instapaper">instapaper</a></div></footer><script src="/scripts/dark.js"></script><script src="/scripts/post.js"></script></body></html>